"use strict";angular.module("--ckgammonApp.services").factory("Board",["Type",function(e){var o=15,r={data:[],existsCheckers:!1,moveOwner:!1,first:void 0,isMoving:void 0,win:void 0,lastMove:void 0,moves:[],moveFromHead:!1,one:{head:{regionIndex:0,cellIndex:0},house:{regionIndex:3,inHouse:!1},thrown:[]},two:{head:{regionIndex:2,cellIndex:0},house:{regionIndex:1,inHouse:!1},thrown:[]}};return r.makeCell=function(e){return{color:e,checkers:[]}},r.makeRegion=function(e){for(var o=[],n=0;3>n;n++)o.push(r.makeCell("black")),o.push(r.makeCell("red"));return"top"==e&&o.push(o.shift()),o},r.addCheckers=function(e,o,r){for(var n=0;r>n;n++)e.checkers.push(o)},r.indexToRegion=function(o){var n={0:3,1:2,2:0,3:1};return r.moveOwner==e.playerTwoType&&(n={0:1,1:0,2:3,3:2}),n[o]},r.indexToCell=function(o,n){if(r.moveOwner==e.playerTwoType){if(2==o||3==o)return n;if(0==o||1==o)return 5-n}return 2==o||3==o?5-n:0==o||1==o?n:void 0},r.getRegionIndex=function(e){var o={0:2,1:3,2:1,3:0};return o[e]},r.getCellIndex=function(e,o){return e=+e,o=+o,2==e||3==e?5-o:0==e||1==e?o:void 0},r.getRegion=function(e){var o=r.getRegionIndex(+e);return void 0!=o?r.data[o]:void 0},r.getCell=function(o,n){o=+o,n=+n,o+=Math.floor(n/6),r.moveOwner==e.playerTwoType&&(o%=4),n%=6,n=r.getCellIndex(o,n);var t=r.getRegion(o);return void 0!=n&&void 0!=t?t[n]:void 0},r.initCheckers=function(){for(var n=0;4>n;n++)for(var t=0;6>t;t++)r.getCell(n,t).checkers=[];e.playerOneType&&e.playerTwoType&&(r.addCheckers(r.getCell(r.one.head.regionIndex,r.one.head.cellIndex),e.playerOneType,o),r.addCheckers(r.getCell(r.two.head.regionIndex,r.two.head.cellIndex),e.playerTwoType,o),r.existsCheckers=!0)},r.init=function(){return r.data=[r.makeRegion("top"),r.makeRegion("top"),r.makeRegion("bottom"),r.makeRegion("bottom")],r.initCheckers(),r.data},r.checkInHouse=function(){var n,t,i=0;if(r.moveOwner==e.playerOneType)n="one",t=r.one.house.regionIndex;else{if(r.moveOwner!=e.playerTwoType)return!1;n="two",t=r.two.house.regionIndex}if(!r[n].house.inHouse){for(var s=0;6>s;s++){var v=r.getCell(t,s).checkers;v.length&&v[v.length-1]==r.moveOwner&&(i+=v.length)}i==o&&(r[n].house.inHouse=!0)}},r.getPlayerMoveOwner=function(){return r.moveOwner==e.playerOneType?"one":r.moveOwner==e.playerTwoType?"two":!1},r.throwChecker=function(n){var t,i;if(r.moveOwner==e.playerOneType)t="one",i=r.one.house.regionIndex;else{if(r.moveOwner!=e.playerTwoType)return!1;t="two",i=r.two.house.regionIndex}n=+n;var s=r.moves.indexOf(6-n);if(-1===s)return!1;var v=r.getCell(i,n);return r.moves.splice(s,1),r[t].thrown.push(v.checkers.pop()),r[t].thrown.length==o?r.lastMove?r.win="draw":r.first!=r.moveOwner&&(r.win=r.moveOwner):r.lastMove&&(r.win=e.getOppositeType(r.moveOwner)),r.moves.length&&r.existsCorrectMovesAtHouse()||r.win||(r[t].thrown.length==o&&r.first==r.moveOwner&&(r.lastMove=!0),r.moveOwner=e.getOppositeType(r.moveOwner),r.isMoving=!1),r[t].thrown},r.move=function(o,n,t,i){var s=r.getCell(+t,+i);for(var v in r.moves){var l=r.getCell(+o,+n),a=r.getCell(+o,+n+ +r.moves[v]);if(a&&(!a.checkers.length||a.checkers[a.checkers.length-1]==r.moveOwner)){if(r.moveOwner==e.playerTwoType&&1==o&&2==t)continue;if(s==a){if(r.moveOwner==e.playerOneType){if(l==r.getCell(r.one.head.regionIndex,r.one.head.cellIndex)){if(r.moveFromHead)continue;r.moveFromHead=!0}}else if(r.moveOwner==e.playerTwoType&&l==r.getCell(r.two.head.regionIndex,r.two.head.cellIndex)){if(r.moveFromHead)continue;r.moveFromHead=!0}r.moves.splice(v,1),a.checkers.push(l.checkers.pop()),r.checkInHouse();var c;return c=r.moveOwner==e.playerOneType&&r.one.house.inHouse||r.moveOwner==e.playerTwoType&&r.two.house.inHouse?r.existsCorrectMovesAtHouse():r.existsCorrectMoves(),r.moves.length&&c||(r.moveOwner=e.getOppositeType(r.moveOwner),r.isMoving=!1,r.moveFromHead=!1),!0}}}return!1},r.existsCorrectMovesAtHouse=function(){var o;if(r.moveOwner==e.playerOneType)o=r.one.house.regionIndex;else{if(r.moveOwner!=e.playerTwoType)return!1;o=r.two.house.regionIndex}for(var n=0;6>n;n++){var t=r.getCell(o,n).checkers;if(t.length&&t[t.length-1]==r.moveOwner&&(r.existsCorrectMovesFrom(o,n)||-1!==r.moves.indexOf(6-n)))return!0}return!1},r.existsCorrectMovesFrom=function(o,n){for(var t in r.moves){var i=r.getCell(o,n),s=r.getCell(o,n+r.moves[t]);if(!(r.moveOwner==e.playerTwoType&&1==o&&n+r.moves[t]>5||!s||s.checkers.length&&s.checkers[s.checkers.length-1]!=r.moveOwner)){if(r.moveOwner==e.playerOneType){if(i==r.getCell(r.one.head.regionIndex,r.one.head.cellIndex)&&r.moveFromHead)continue}else if(r.moveOwner==e.playerTwoType&&i==r.getCell(r.two.head.regionIndex,r.two.head.cellIndex)&&r.moveFromHead)continue;return!0}}return!1},r.existsCorrectMoves=function(){for(var e=0;4>e;e++)for(var o=0;6>o;o++){var n=r.getCell(e,o).checkers;if(n.length&&n[n.length-1]==r.moveOwner&&r.existsCorrectMovesFrom(e,o))return!0}return!1},r.discardMoves=function(){r.moves=[],r.isMoving=!1,r.moveOwner=e.getOppositeType(r.moveOwner)},r.setMoves=function(o){if(r.moves=[],o[0]==o[1])for(var n=0;4>n;n++)r.moves.push(o[0]);else r.moves.push(o[0]),r.moves.push(o[1]);r.moveFromHead=!1;var t;return t=r.moveOwner==e.playerOneType&&r.one.house.inHouse||r.moveOwner==e.playerTwoType&&r.two.house.inHouse?r.existsCorrectMovesAtHouse():r.existsCorrectMoves(),t||r.discardMoves(),r.moves},r}]);