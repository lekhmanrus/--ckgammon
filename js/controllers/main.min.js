"use strict";angular.module("--ckgammonApp.controllers").controller("MainController",["$scope","$timeout","ArtificialIntelligence","Type","Board","Dice",function(e,o,t,a,s,n){var r=void 0,i=void 0,l=1500,u=function(){e.dices={red:{value:void 0,rolled:void 0},black:{value:void 0,rolled:void 0}},r=void 0,i=void 0};u();var c={red:"black",black:"red"};e.roll=function(t){e.dices[t].value||e.dices[c[t]].rolled&&!i||(i?e.dices[t].value=n.roll():(r=t,e.dices[t].value=n.roll(),e.dices[t].rolled=!0,o(function(){"human"!=e.usersData.two.type?e.dices[c[t]].value=n.roll():i=!0},l)),i=!1)},e.$watch("[dices.red.value, dices.black.value]",function(){e.dices.red.value&&e.dices.black.value&&(e.dices.red.value==e.dices.black.value?o(function(){u(),"ai"==e.usersData.one.type&&e.roll(Object.keys(e.dices)[Math.floor(Math.random()*Object.keys(e.dices).length)])},l):(s.moveOwner=s.first=e.dices[r].value>e.dices[c[r]].value?a.playerOneType:a.playerTwoType,o(function(){e.statusDices=!1,s.isMoving=!1},l)))});var v=function(){o(function(){if("ai"==e.usersData.two.type&&s.moveOwner==e.usersData.two.color){var o=!1;if(s.two.house.inHouse&&(o=s.throwAnyChecker()),o)s.moves.length>0&&v();else{var a=s.getAvailableMoves();if(a.length>0){var n=t.getNextMove(a,s.getPlayerMoveOwner());s.move(n.from.regionIndex,n.from.cellIndex,n.to.regionIndex,n.to.cellIndex)?s.moves.length>0&&v():console.log("AI selecting move error...")}}}else if("ai"==e.usersData.one.type&&s.moveOwner==e.usersData.one.color){var o=!1;if(s.one.house.inHouse&&(o=s.throwAnyChecker()),o)s.moves.length>0&&v();else{var a=s.getAvailableMoves();if(a.length>0){var n=t.getNextMove(a,s.getPlayerMoveOwner());s.move(n.from.regionIndex,n.from.cellIndex,n.to.regionIndex,n.to.cellIndex)?s.moves.length>0&&v():console.log("AI selecting move error...")}}}},500)};e.$watchCollection(function(){return[s.isMoving,s.moveOwner]},function(o){o[1]&&(e.mOwn=s.getPlayerMoveOwner()),e.statusDiceGroup=!o[0],!o[0]&&o[1]&&("ai"==e.usersData.two.type&&o[1]==e.usersData.two.color?e.rollGroup(v):"ai"==e.usersData.one.type&&o[1]==e.usersData.one.color&&e.rollGroup(v))}),e.$watch(function(){return s.one.house.inHouse},function(o){e.statusPlayerOneHouse=o}),e.$watch(function(){return s.two.house.inHouse},function(o){e.statusPlayerTwoHouse=o}),e.$watch(function(){return s.win},function(o){void 0!=o&&(e.win=e.usersData.one.color==o?"one":e.usersData.two.color==o?"two":o,e.statusNewGameDialogClose=!1,e.showNewGameDialog())});var d=!1;e.rollGroup=function(t){d||(d=!0,e.diceGroupValues=[void 0,void 0],o(function(){e.diceGroupValues[0]=n.roll(),e.diceGroupValues[1]=n.roll()}),o(function(){s.isMoving=!0,s.setMoves(e.diceGroupValues),(t||angular.noop)(),d=!1},l+500))},e.statusDices=!0,e.statusDiceGroup=!1,e.statusNewGameDialog=!0,e.statusNewGameDialogClose=!1,e.statusPlayerOneHouse=!1,e.statusPlayerTwoHouse=!1,e.win=!1,e.mOwn=void 0,e.diceGroupValues=[void 0,void 0],e.showNewGameDialog=function(){e.statusNewGameDialog=!0},e.hideNewGameDialog=function(){e.statusNewGameDialog=!1},e.colors=a.data,e.usersData={one:{name:"L",color:void 0,type:"human"},two:{name:"KIRA",color:void 0,type:"ai"}},e.chooseColor=function(o){e.usersData.one.color=o,e.usersData.two.color=a.getOppositeType(o)},e.$watch("usersData.two.type",function(o){e.usersData.two.type=o}),e.newGame=function(){a.setPlayerOneType(e.usersData.one.color),s.initCheckers(),e.statusNewGameDialog=!1,e.statusNewGameDialogClose=s.existsCheckers,e.statusDices=!0,e.statusDiceGroup=!1,s.isMoving=!0,s.moveOwner=!1,s.first=void 0,s.win=void 0,s.lastMove=void 0,s.one.house.inHouse=!1,s.two.house.inHouse=!1,e.statusPlayerOneHouse=!1,e.statusPlayerTwoHouse=!1,s.one.thrown=[],s.two.thrown=[],e.win=!1,e.mOwn=void 0,e.diceGroupValues=[void 0,void 0],u(),"ai"==e.usersData.one.type&&e.roll(Object.keys(e.dices)[Math.floor(Math.random()*Object.keys(e.dices).length)])},e.isDisabled=function(){return!(e.usersData.one.color&&e.usersData.two.color&&e.usersData.one.name&&e.usersData.two.name&&e.usersData.two.type)}}]);